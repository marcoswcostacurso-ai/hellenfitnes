<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hellen Moda Fitness</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    <style>
        /* ===== VARIÁVEIS DE CORES ===== */
        :root {
            --primary-color: #c8499f;
            --secondary-color: #ffffff;
            --text-color: #333333;
            --border-color: #e0e0e0;
            --header-height: 70px;
            --footer-height: 200px;
        }

        /* ===== ESTILOS GERAIS ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }

        body {
            background-color: var(--secondary-color);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        a {
            text-decoration: none;
            color: inherit;
        }

        button {
            cursor: pointer;
            border: none;
            outline: none;
        }

        .back-button {
            background-color: #6c757d;
            color: white;
            padding: 10px 20px;
            border-radius: 4px;
            margin-bottom: 20px;
            font-size: 16px;
        }

        /* ===== HEADER ===== */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            height: var(--header-height);
            background-color: var(--secondary-color);
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            height: 50px;
            display: flex;
            align-items: center;
        }

        .logo-image {
            height: 100%;
            width: auto;
            max-width: 200px;
            object-fit: contain;
        }

        .header-icons {
            display: flex;
            gap: 20px;
        }

        .icon {
            font-size: 24px;
            cursor: pointer;
            position: relative;
        }

        .cart-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* ===== MENU LATERAL ===== */
        .side-menu {
            position: fixed;
            top: 0;
            right: -300px;
            width: 300px;
            height: 100%;
            background-color: var(--secondary-color);
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
            transition: right 0.3s ease;
            z-index: 1000;
            padding: 20px;
        }

        .side-menu.active {
            right: 0;
        }

        .close-menu {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 24px;
            cursor: pointer;
        }

        .menu-items {
            margin-top: 50px;
        }

        .menu-item {
            padding: 15px 0;
            border-bottom: 1px solid var(--border-color);
            font-size: 18px;
            cursor: pointer;
        }

        /* ===== MENSAGEM ABAIXO DO HEADER ===== */
        .message-bar {
            background-color: #f9f9f9;
            padding: 10px 20px;
            text-align: center;
            font-size: 14px;
        }

        /* ===== CATÁLOGO DE PRODUTOS ===== */
        .products-section {
            padding: 20px;
            flex: 1;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .product-card {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        .product-card:hover {
            transform: translateY(-5px);
        }

        .product-image {
            width: 100%;
            height: 250px;
            object-fit: cover;
            cursor: pointer;
        }

        .product-info {
            padding: 15px;
        }

        .product-name {
            font-size: 16px;
            margin-bottom: 10px;
        }

        .product-price {
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        .buy-button {
            background-color: var(--primary-color);
            color: white;
            padding: 10px 15px;
            border-radius: 4px;
            width: 100%;
            font-size: 16px;
        }

        .out-of-stock {
            background-color: #6c757d;
            cursor: not-allowed;
        }

        /* ===== PÁGINA DO PRODUTO ===== */
        .product-page {
            padding: 20px;
            display: none;
        }

        .product-details {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        @media (min-width: 768px) {
            .product-details {
                flex-direction: row;
            }
        }

        .product-image-large {
            flex: 1;
            max-width: 500px;
        }

        .product-image-large img {
            width: 100%;
            height: auto;
            border-radius: 8px;
        }

        .product-options {
            flex: 1;
        }

        .color-options {
            margin: 20px 0;
        }

        .color-option {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
        }

        .color-swatch {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin-right: 10px;
            border: 1px solid var(--border-color);
        }

        .quantity-input {
            width: 60px;
            padding: 5px;
            margin-left: 10px;
        }

        .stock-warning {
            color: #dc3545;
            font-size: 12px;
            margin-left: 10px;
        }

        .add-to-cart-button {
            background-color: var(--primary-color);
            color: white;
            padding: 15px 30px;
            border-radius: 4px;
            font-size: 18px;
            margin-top: 20px;
        }

        .add-to-cart-button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }

        /* ===== CARRINHO ===== */
        .cart-section {
            padding: 20px;
            display: none;
        }

        .cart-items {
            margin-bottom: 20px;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-quantity {
            margin: 0 10px;
        }

        .remove-item {
            color: red;
            cursor: pointer;
            padding: 5px 10px;
        }

        .cart-total {
            font-size: 20px;
            font-weight: bold;
            text-align: right;
            margin-bottom: 20px;
        }

        /* ===== BOTÃO FINALIZAR COMPRA FLUTUANTE ===== */
        .floating-checkout {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--primary-color);
            color: white;
            padding: 15px 25px;
            border-radius: 50px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            font-size: 16px;
            z-index: 99;
        }

        /* ===== FORMULÁRIO DE FINALIZAÇÃO ===== */
        .checkout-section {
            padding: 20px;
            display: none;
        }

        .checkout-form {
            max-width: 600px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
        }

        .submit-order {
            background-color: var(--primary-color);
            color: white;
            padding: 15px 30px;
            border-radius: 4px;
            font-size: 18px;
            width: 100%;
            margin-top: 20px;
        }

        /* ===== FOOTER ===== */
        footer {
            background-color: #f9f9f9;
            padding: 30px 20px;
            margin-top: auto;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        @media (min-width: 768px) {
            .footer-content {
                flex-direction: row;
                justify-content: space-between;
            }
        }

        .footer-section {
            flex: 1;
        }

        .footer-section h3 {
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        .footer-section p {
            margin-bottom: 10px;
        }

        .admin-icon {
            text-align: center;
            margin-top: 20px;
            cursor: pointer;
        }

        /* ===== PAINEL DO ADMINISTRADOR ===== */
        .admin-panel {
            padding: 20px;
            display: none;
        }

        .admin-login {
            max-width: 400px;
            margin: 50px auto;
            padding: 20px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
        }

        .admin-login h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        .admin-section {
            margin-bottom: 30px;
        }

        .admin-section h3 {
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        .product-form {
            max-width: 600px;
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
        }

        .color-input {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
        }

        .color-input input {
            padding: 5px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
        }

        .remove-color {
            background: red;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
        }

        .inventory-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .inventory-table th,
        .inventory-table td {
            border: 1px solid var(--border-color);
            padding: 10px;
            text-align: left;
        }

        .inventory-table th {
            background-color: #f5f5f5;
        }

        .edit-button, .delete-button {
            padding: 5px 10px;
            margin-right: 5px;
            border-radius: 4px;
            cursor: pointer;
        }

        .edit-button {
            background-color: #4CAF50;
            color: white;
            border: none;
        }

        .delete-button {
            background-color: #f44336;
            color: white;
            border: none;
        }

        /* ===== MODAIS E POPUPS ===== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .modal {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
            position: relative;
        }

        .close-modal {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 24px;
            cursor: pointer;
        }

        /* ===== RESPONSIVIDADE ===== */
        @media (max-width: 768px) {
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }

            .header-icons {
                gap: 15px;
            }

            .icon {
                font-size: 20px;
            }

            .floating-checkout {
                padding: 12px 20px;
                font-size: 14px;
            }

            .color-input {
                flex-direction: column;
                align-items: stretch;
            }

            .logo {
                height: 40px;
            }

            .logo-image {
                max-width: 150px;
            }

            .cart-badge {
                width: 18px;
                height: 18px;
                font-size: 10px;
                top: -6px;
                right: -6px;
            }
        }
    </style>
</head>
<body>
    <!-- ===== HEADER ===== -->
    <header>
        <div class="logo">
            <img src="https://i.postimg.cc/bNw1g81L/Design-sem-nome-9.png" alt="Hellen Moda Fitness" class="logo-image">
        </div>
        <div class="header-icons">
            <div class="icon" id="home-icon">🏠</div>
            <div class="icon" id="menu-icon">☰</div>
            <div class="icon" id="cart-icon">
                🛒
                <div class="cart-badge" id="cart-badge" style="display: none;">0</div>
            </div>
        </div>
    </header>

    <!-- ===== MENU LATERAL ===== -->
    <div class="side-menu" id="side-menu">
        <div class="close-menu" id="close-menu">✕</div>
        <div class="menu-items">
            <div class="menu-item" data-category="all">Todos os produtos</div>
            <div class="menu-item" data-category="conjuntos">Conjuntos</div>
            <div class="menu-item" data-category="macaquinhos">Macaquinhos</div>
            <div class="menu-item" data-category="tops">Tops</div>
            <div class="menu-item" data-category="shorts">Shorts</div>
        </div>
    </div>

    <!-- ===== MENSAGEM ABAIXO DO HEADER ===== -->
    <div class="message-bar">
        Escolha seu produto e seu pedido será enviado via WhatsApp.
    </div>

    <!-- ===== CATÁLOGO DE PRODUTOS ===== -->
    <section class="products-section" id="products-section">
        <div class="products-grid" id="products-grid">
            <!-- Produtos serão carregados dinamicamente aqui -->
        </div>
    </section>

    <!-- ===== PÁGINA DO PRODUTO ===== -->
    <section class="product-page" id="product-page">
        <button class="back-button" id="back-from-product">← Voltar ao Catálogo</button>
        <div class="product-details">
            <div class="product-image-large">
                <img id="product-large-image" src="" alt="Produto">
            </div>
            <div class="product-options">
                <h2 id="product-page-name"></h2>
                <p id="product-page-price"></p>
                <div class="color-options" id="color-options">
                    <!-- Opções de cor serão carregadas dinamicamente aqui -->
                </div>
                <button class="add-to-cart-button" id="add-to-cart">Adicionar ao Carrinho</button>
            </div>
        </div>
    </section>

    <!-- ===== CARRINHO ===== -->
    <section class="cart-section" id="cart-section">
        <button class="back-button" id="back-from-cart">← Voltar ao Catálogo</button>
        <h2>Seu Carrinho</h2>
        <div class="cart-items" id="cart-items">
            <!-- Itens do carrinho serão carregados dinamicamente aqui -->
        </div>
        <div class="cart-total" id="cart-total">Total: R$ 0,00</div>
        <button class="floating-checkout" id="checkout-button">Finalizar Compra</button>
    </section>

    <!-- ===== FORMULÁRIO DE FINALIZAÇÃO ===== -->
    <section class="checkout-section" id="checkout-section">
        <button class="back-button" id="back-from-checkout">← Voltar ao Catálogo</button>
        <h2>Finalizar Pedido</h2>
        <div class="checkout-form">
            <div class="form-group">
                <label for="customer-name">Nome:</label>
                <input type="text" id="customer-name" required>
            </div>
            <div class="form-group">
                <label for="customer-cep">CEP:</label>
                <input type="text" id="customer-cep" required>
                <small>O frete será calculado quando o pedido for enviado via WhatsApp.</small>
            </div>
            <div class="form-group">
                <label for="customer-address">Endereço:</label>
                <input type="text" id="customer-address" required>
            </div>
            <div class="form-group">
                <label for="delivery-type">Tipo de entrega:</label>
                <select id="delivery-type" required>
                    <option value="">Selecione</option>
                    <option value="transportadora">Transportadora</option>
                    <option value="excursões">Excursões</option>
                    <option value="uber">Uber</option>
                    <option value="correio">Correio</option>
                </select>
            </div>
            <div class="form-group">
                <label for="customer-phone">Telefone:</label>
                <input type="tel" id="customer-phone" required>
            </div>
            <div class="form-group">
                <label for="payment-method">Forma de pagamento:</label>
                <select id="payment-method" required>
                    <option value="">Selecione</option>
                    <option value="pix">Pix</option>
                </select>
            </div>
            <div class="form-group">
                <p><strong>Aviso:</strong> pedido mínimo de 10 peças.</p>
            </div>
            <button class="submit-order" id="submit-order">Enviar Pedido via WhatsApp</button>
        </div>
    </section>

    <!-- ===== BOTÃO FINALIZAR COMPRA FLUTUANTE ===== -->
    <button class="floating-checkout" id="floating-checkout">Finalizar Compra</button>

    <!-- ===== FOOTER ===== -->
    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>Contato</h3>
                <p>Telefone: (85) 99772-0832</p>
                <p>Endereço: Rua José Valdir Barbosa 45 - Maranguape</p>
                <p>E-mail: contato@hellenfitnes.com.br</p>
            </div>
            <div class="footer-section">
                <h3>Redes Sociais</h3>
                <p>Instagram: @hellen_moda_fitness</p>
                <p>WhatsApp: (85) 99772-0832</p>
            </div>
        </div>
        <div class="admin-icon" id="admin-icon">
            <span>🎲</span>
        </div>
    </footer>

    <!-- ===== PAINEL DO ADMINISTRADOR ===== -->
    <section class="admin-panel" id="admin-panel">
        <button class="back-button" id="back-from-admin">← Voltar ao Catálogo</button>
        <div class="admin-login" id="admin-login">
            <h2>Login do Administrador</h2>
            <div class="form-group">
                <label for="admin-email">E-mail:</label>
                <input type="email" id="admin-email" required>
            </div>
            <div class="form-group">
                <label for="admin-password">Senha:</label>
                <input type="password" id="admin-password" required>
            </div>
            <button class="submit-order" id="admin-login-button">Entrar</button>
        </div>

        <div class="admin-dashboard" id="admin-dashboard" style="display: none;">
            <h2>Painel do Administrador</h2>
            
            <div class="admin-section">
                <h3>Adicionar/Editar Produto</h3>
                <div class="product-form">
                    <div class="form-group">
                        <label for="product-name">Nome do Produto:</label>
                        <input type="text" id="product-name" required>
                    </div>
                    <div class="form-group">
                        <label for="product-price">Preço (R$):</label>
                        <input type="number" id="product-price" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="product-category">Categoria:</label>
                        <select id="product-category" required>
                            <option value="">Selecione</option>
                            <option value="conjuntos">Conjuntos</option>
                            <option value="macaquinhos">Macaquinhos</option>
                            <option value="tops">Tops</option>
                            <option value="shorts">Shorts</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="product-image">Imagem (URL):</label>
                        <input type="text" id="product-image" required>
                    </div>
                    <div class="form-group">
                        <label>Cores e Estoque:</label>
                        <div id="color-inputs">
                            <!-- Inputs de cor serão adicionados dinamicamente -->
                        </div>
                        <button type="button" id="add-color">Adicionar Cor</button>
                    </div>
                    <button class="submit-order" id="save-product">Salvar Produto</button>
                    <button type="button" id="cancel-edit" style="background-color: #6c757d; margin-top: 10px;">Cancelar Edição</button>
                </div>
            </div>

            <div class="admin-section">
                <h3>Controle de Estoque</h3>
                <table class="inventory-table" id="inventory-table">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Categoria</th>
                            <th>Preço</th>
                            <th>Cores/Estoque</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="inventory-body">
                        <!-- Dados do estoque serão carregados dinamicamente aqui -->
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- ===== MODAL DE CONFIRMAÇÃO ===== -->
    <div class="modal-overlay" id="confirmation-modal">
        <div class="modal">
            <div class="close-modal" id="close-confirmation">✕</div>
            <h3 id="modal-title">Confirmação</h3>
            <p id="modal-message"></p>
            <button class="submit-order" id="modal-confirm">OK</button>
        </div>
    </div>

    <script>
        // ===== CONFIGURAÇÃO DO FIREBASE =====
        const firebaseConfig = {
            apiKey: "AIzaSyAn5SPhZJPqR6IdQecnFnMwLdDm3efy4ko",
            authDomain: "hellen-moda-fitnes.firebaseapp.com",
            projectId: "hellen-moda-fitnes",
            storageBucket: "hellen-moda-fitnes.firebasestorage.app",
            messagingSenderId: "998940228851",
            appId: "1:998940228851:web:d4e8d3ac366c26fe9e4b86"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // ===== VARIÁVEIS GLOBAIS =====
        let currentUser = null;
        let products = [];
        let cart = [];
        let editingProductId = null;

        // ===== ELEMENTOS DO DOM =====
        const elements = {
            productsSection: document.getElementById('products-section'),
            productPage: document.getElementById('product-page'),
            cartSection: document.getElementById('cart-section'),
            checkoutSection: document.getElementById('checkout-section'),
            adminPanel: document.getElementById('admin-panel'),
            
            backFromProduct: document.getElementById('back-from-product'),
            backFromCart: document.getElementById('back-from-cart'),
            backFromCheckout: document.getElementById('back-from-checkout'),
            backFromAdmin: document.getElementById('back-from-admin'),
            
            sideMenu: document.getElementById('side-menu'),
            menuIcon: document.getElementById('menu-icon'),
            closeMenu: document.getElementById('close-menu'),
            menuItems: document.querySelectorAll('.menu-item'),
            
            homeIcon: document.getElementById('home-icon'),
            cartIcon: document.getElementById('cart-icon'),
            cartBadge: document.getElementById('cart-badge'),
            
            productsGrid: document.getElementById('products-grid'),
            productLargeImage: document.getElementById('product-large-image'),
            productPageName: document.getElementById('product-page-name'),
            productPagePrice: document.getElementById('product-page-price'),
            colorOptions: document.getElementById('color-options'),
            addToCart: document.getElementById('add-to-cart'),
            
            cartItems: document.getElementById('cart-items'),
            cartTotal: document.getElementById('cart-total'),
            checkoutButton: document.getElementById('checkout-button'),
            floatingCheckout: document.getElementById('floating-checkout'),
            
            customerName: document.getElementById('customer-name'),
            customerCep: document.getElementById('customer-cep'),
            customerAddress: document.getElementById('customer-address'),
            deliveryType: document.getElementById('delivery-type'),
            customerPhone: document.getElementById('customer-phone'),
            paymentMethod: document.getElementById('payment-method'),
            submitOrder: document.getElementById('submit-order'),
            
            adminIcon: document.getElementById('admin-icon'),
            adminLogin: document.getElementById('admin-login'),
            adminDashboard: document.getElementById('admin-dashboard'),
            adminEmail: document.getElementById('admin-email'),
            adminPassword: document.getElementById('admin-password'),
            adminLoginButton: document.getElementById('admin-login-button'),
            productName: document.getElementById('product-name'),
            productPrice: document.getElementById('product-price'),
            productCategory: document.getElementById('product-category'),
            productImage: document.getElementById('product-image'),
            colorInputs: document.getElementById('color-inputs'),
            addColor: document.getElementById('add-color'),
            saveProduct: document.getElementById('save-product'),
            cancelEdit: document.getElementById('cancel-edit'),
            inventoryBody: document.getElementById('inventory-body'),
            
            confirmationModal: document.getElementById('confirmation-modal'),
            closeConfirmation: document.getElementById('close-confirmation'),
            modalTitle: document.getElementById('modal-title'),
            modalMessage: document.getElementById('modal-message'),
            modalConfirm: document.getElementById('modal-confirm')
        };

        // ===== INICIALIZAÇÃO =====
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            loadProducts();
            checkAuthState();
        });

        function initializeApp() {
            showSection(elements.productsSection);
            
            const savedCart = localStorage.getItem('hellenCart');
            if (savedCart) {
                cart = JSON.parse(savedCart);
                updateCartDisplay();
            }
        }

        function setupEventListeners() {
            elements.homeIcon.addEventListener('click', () => showSection(elements.productsSection));
            elements.cartIcon.addEventListener('click', () => showSection(elements.cartSection));
            elements.menuIcon.addEventListener('click', () => elements.sideMenu.classList.add('active'));
            elements.closeMenu.addEventListener('click', () => elements.sideMenu.classList.remove('active'));
            
            elements.backFromProduct.addEventListener('click', () => showSection(elements.productsSection));
            elements.backFromCart.addEventListener('click', () => showSection(elements.productsSection));
            elements.backFromCheckout.addEventListener('click', () => showSection(elements.productsSection));
            elements.backFromAdmin.addEventListener('click', () => showSection(elements.productsSection));
            
            elements.menuItems.forEach(item => {
                item.addEventListener('click', function() {
                    const category = this.getAttribute('data-category');
                    filterProductsByCategory(category);
                    elements.sideMenu.classList.remove('active');
                });
            });
            
            elements.checkoutButton.addEventListener('click', () => showSection(elements.checkoutSection));
            elements.floatingCheckout.addEventListener('click', () => showSection(elements.checkoutSection));
            elements.submitOrder.addEventListener('click', submitOrder);
            
            elements.adminIcon.addEventListener('click', () => showSection(elements.adminPanel));
            elements.adminLoginButton.addEventListener('click', adminLogin);
            elements.addColor.addEventListener('click', addColorInput);
            elements.saveProduct.addEventListener('click', saveProduct);
            elements.cancelEdit.addEventListener('click', resetProductForm);
            
            elements.closeConfirmation.addEventListener('click', () => elements.confirmationModal.style.display = 'none');
            elements.modalConfirm.addEventListener('click', () => elements.confirmationModal.style.display = 'none');
        }

        // ===== FUNÇÕES DE NAVEGAÇÃO =====
        function showSection(section) {
            const sections = [
                elements.productsSection,
                elements.productPage,
                elements.cartSection,
                elements.checkoutSection,
                elements.adminPanel
            ];
            
            sections.forEach(sec => {
                if (sec) sec.style.display = 'none';
            });
            
            if (section) section.style.display = 'block';
            updateCartDisplay();
        }

        // ===== FUNÇÕES DE PRODUTOS =====
        function loadProducts() {
            db.collection('produtoshellen').get()
                .then(snapshot => {
                    products = [];
                    elements.productsGrid.innerHTML = '';
                    
                    snapshot.forEach(doc => {
                        const product = {
                            id: doc.id,
                            ...doc.data()
                        };
                        products.push(product);
                        renderProduct(product);
                    });
                })
                .catch(error => {
                    console.error('Erro ao carregar produtos:', error);
                    showModal('Erro', 'Erro ao carregar produtos: ' + error.message);
                });
        }

        function renderProduct(product) {
            const productCard = document.createElement('div');
            productCard.className = 'product-card';
            
            // Verificar se o produto tem estoque
            const hasStock = product.colors && product.colors.some(color => color.stock > 0);
            const buttonClass = hasStock ? 'buy-button' : 'buy-button out-of-stock';
            const buttonText = hasStock ? 'Comprar' : 'Sem Estoque';
            
            productCard.innerHTML = `
                <img src="${product.image}" alt="${product.name}" class="product-image" data-id="${product.id}">
                <div class="product-info">
                    <div class="product-name">${product.name}</div>
                    <div class="product-price">R$ ${product.price.toFixed(2)}</div>
                    <button class="${buttonClass}" data-id="${product.id}" ${!hasStock ? 'disabled' : ''}>${buttonText}</button>
                </div>
            `;
            
            elements.productsGrid.appendChild(productCard);
            
            if (hasStock) {
                const productImage = productCard.querySelector('.product-image');
                const buyButton = productCard.querySelector('.buy-button');
                
                productImage.addEventListener('click', () => showProductPage(product.id));
                buyButton.addEventListener('click', () => showProductPage(product.id));
            }
        }

        function showProductPage(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            elements.productLargeImage.src = product.image;
            elements.productPageName.textContent = product.name;
            elements.productPagePrice.textContent = `R$ ${product.price.toFixed(2)}`;
            
            elements.colorOptions.innerHTML = '';
            
            let hasAvailableStock = false;
            
            if (product.colors && product.colors.length > 0) {
                product.colors.forEach((color, index) => {
                    const colorOption = document.createElement('div');
                    colorOption.className = 'color-option';
                    
                    // REMOVIDO O LIMITE MÁXIMO - só verifica estoque disponível
                    const isOutOfStock = color.stock === 0;
                    
                    colorOption.innerHTML = `
                        <div class="color-swatch" style="background-color: ${color.code}"></div>
                        <span>${color.name}</span>
                        <input type="number" class="quantity-input" data-color-index="${index}" 
                               min="0" value="0" ${isOutOfStock ? 'disabled' : ''}>
                        <span>Estoque: ${color.stock}</span>
                        ${isOutOfStock ? '<span class="stock-warning">(Sem estoque)</span>' : ''}
                    `;
                    elements.colorOptions.appendChild(colorOption);
                    
                    if (!isOutOfStock) hasAvailableStock = true;
                });
            }
            
            // Habilitar/desabilitar botão de adicionar ao carrinho
            elements.addToCart.disabled = !hasAvailableStock;
            if (!hasAvailableStock) {
                elements.addToCart.textContent = 'Produto sem estoque';
                elements.addToCart.style.backgroundColor = '#6c757d';
            } else {
                elements.addToCart.textContent = 'Adicionar ao Carrinho';
                elements.addToCart.style.backgroundColor = 'var(--primary-color)';
            }
            
            elements.addToCart.onclick = () => addProductToCart(product);
            showSection(elements.productPage);
        }

        function filterProductsByCategory(category) {
            if (category === 'all') {
                const productCards = document.querySelectorAll('.product-card');
                productCards.forEach(card => card.style.display = 'block');
            } else {
                const productCards = document.querySelectorAll('.product-card');
                productCards.forEach(card => {
                    const productId = card.querySelector('.buy-button')?.getAttribute('data-id');
                    const product = products.find(p => p.id === productId);
                    card.style.display = (product && product.category === category) ? 'block' : 'none';
                });
            }
        }

        // ===== FUNÇÕES DO CARRINHO - VERSÃO CORRIGIDA =====
        function addProductToCart(product) {
            const quantityInputs = document.querySelectorAll('.quantity-input');
            let totalQuantity = 0;
            const colorQuantities = [];
            
            // Validar quantidades antes de adicionar ao carrinho
            let hasError = false;
            let errorMessage = '';
            
            quantityInputs.forEach(input => {
                const quantity = parseInt(input.value) || 0;
                const colorIndex = parseInt(input.getAttribute('data-color-index'));
                
                if (quantity > 0) {
                    const colorStock = product.colors[colorIndex].stock;
                    
                    // Verificar se a quantidade solicitada está disponível
                    if (quantity > colorStock) {
                        hasError = true;
                        errorMessage = `Quantidade indisponível para ${product.colors[colorIndex].name}. Estoque: ${colorStock}`;
                        return;
                    }
                    
                    totalQuantity += quantity;
                    colorQuantities.push({
                        colorIndex: colorIndex,
                        colorName: product.colors[colorIndex].name,
                        quantity: quantity
                    });
                }
            });
            
            if (hasError) {
                showModal('Erro de Estoque', errorMessage);
                return;
            }
            
            if (totalQuantity === 0) {
                showModal('Atenção', 'Selecione pelo menos uma peça para adicionar ao carrinho.');
                return;
            }
            
            // CORREÇÃO: Agrupar itens iguais
            const existingItemIndex = cart.findIndex(item => 
                item.productId === product.id && 
                arraysEqual(item.colorQuantities, colorQuantities)
            );
            
            if (existingItemIndex !== -1) {
                // Verificar estoque novamente antes de somar
                const newTotalQuantity = cart[existingItemIndex].quantity + totalQuantity;
                let stockError = false;
                
                colorQuantities.forEach(cq => {
                    const colorStock = product.colors[cq.colorIndex].stock;
                    const existingQuantity = cart[existingItemIndex].colorQuantities
                        .find(itemCq => itemCq.colorIndex === cq.colorIndex)?.quantity || 0;
                    const newQuantity = existingQuantity + cq.quantity;
                    
                    if (newQuantity > colorStock) {
                        stockError = true;
                        errorMessage = `Quantidade total indisponível para ${cq.colorName}. Estoque: ${colorStock}`;
                    }
                });
                
                if (stockError) {
                    showModal('Erro de Estoque', errorMessage);
                    return;
                }
                
                cart[existingItemIndex].quantity += totalQuantity;
                // Atualizar quantidades por cor
                colorQuantities.forEach(cq => {
                    const existingColorItem = cart[existingItemIndex].colorQuantities
                        .find(itemCq => itemCq.colorIndex === cq.colorIndex);
                    if (existingColorItem) {
                        existingColorItem.quantity += cq.quantity;
                    }
                });
            } else {
                cart.push({
                    productId: product.id,
                    name: product.name,
                    price: product.price,
                    image: product.image,
                    colorQuantities: colorQuantities,
                    quantity: totalQuantity
                });
            }
            
            saveCart();
            updateCartDisplay();
            showModal('Sucesso', 'Produto adicionado ao carrinho!');
            showSection(elements.productsSection);
        }

        // Função auxiliar para comparar arrays de cores
        function arraysEqual(arr1, arr2) {
            if (arr1.length !== arr2.length) return false;
            for (let i = 0; i < arr1.length; i++) {
                if (arr1[i].colorIndex !== arr2[i].colorIndex || 
                    arr1[i].colorName !== arr2[i].colorName) {
                    return false;
                }
            }
            return true;
        }

        function updateCartDisplay() {
            elements.cartItems.innerHTML = '';
            let total = 0;
            
            cart.forEach((item, index) => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <div class="cart-item-info">
                        <div><strong>${item.name}</strong></div>
                        <div>${item.colorQuantities.map(cq => `${cq.colorName}: ${cq.quantity}`).join(', ')}</div>
                        <div>R$ ${item.price.toFixed(2)} cada</div>
                    </div>
                    <div class="cart-item-quantity">${item.quantity} un.</div>
                    <div class="remove-item" data-index="${index}">✕</div>
                `;
                
                elements.cartItems.appendChild(cartItem);
            });
            
            elements.cartTotal.textContent = `Total: R$ ${total.toFixed(2)}`;
            
            const removeButtons = document.querySelectorAll('.remove-item');
            removeButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    removeFromCart(index);
                });
            });
            
            updateCartIcon();
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            saveCart();
            updateCartDisplay();
        }

        function saveCart() {
            localStorage.setItem('hellenCart', JSON.stringify(cart));
        }

        function updateCartIcon() {
            const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
            
            // Atualizar a bolinha do carrinho
            if (totalItems > 0) {
                elements.cartBadge.textContent = totalItems;
                elements.cartBadge.style.display = 'flex';
            } else {
                elements.cartBadge.style.display = 'none';
            }
        }

        // ===== FINALIZAÇÃO DO PEDIDO =====
        function submitOrder() {
            // Validar estoque antes de finalizar
            if (!validateStockBeforeCheckout()) {
                return;
            }
            
            if (!validateOrderForm()) return;
            
            const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
            if (totalItems < 10) {
                showModal('Atenção', 'Pedido mínimo de 10 peças não atingido.');
                return;
            }
            
            const orderData = {
                customer: {
                    name: elements.customerName.value,
                    cep: elements.customerCep.value,
                    address: elements.customerAddress.value,
                    deliveryType: elements.deliveryType.value,
                    phone: elements.customerPhone.value,
                    paymentMethod: elements.paymentMethod.value
                },
                items: cart,
                total: cart.reduce((total, item) => total + (item.price * item.quantity), 0),
                timestamp: new Date().toISOString(),
                status: 'pendente'
            };
            
            db.collection('pedidoshellen').add(orderData)
                .then(docRef => {
                    console.log('Pedido salvo com ID:', docRef.id);
                    return reduceStock();
                })
                .then(() => {
                    const whatsappMessage = prepareWhatsAppMessage(orderData);
                    
                    cart = [];
                    saveCart();
                    updateCartDisplay();
                    
                    window.open(`https://wa.me/5585989408154?text=${encodeURIComponent(whatsappMessage)}`, '_blank');
                    
                    showModal('Sucesso', 'Pedido enviado com sucesso! Você será redirecionado para o WhatsApp.');
                    
                    showSection(elements.productsSection);
                    clearCheckoutForm();
                })
                .catch(error => {
                    console.error('Erro ao enviar pedido:', error);
                    showModal('Erro', 'Ocorreu um erro ao enviar o pedido. Tente novamente.');
                });
        }

        // VALIDAÇÃO DE ESTOQUE ANTES DO CHECKOUT
        function validateStockBeforeCheckout() {
            const promises = cart.map(item => {
                return db.collection('produtoshellen').doc(item.productId).get()
                    .then(doc => {
                        if (doc.exists) {
                            const product = doc.data();
                            let errorMessage = '';
                            
                            // Verificar cada cor do item no carrinho
                            item.colorQuantities.forEach(cq => {
                                const color = product.colors[cq.colorIndex];
                                if (color && cq.quantity > color.stock) {
                                    errorMessage = `Estoque insuficiente para ${item.name} (${cq.colorName}). Disponível: ${color.stock}, Solicitado: ${cq.quantity}`;
                                }
                            });
                            
                            if (errorMessage) {
                                throw new Error(errorMessage);
                            }
                        }
                    });
            });
            
            return Promise.all(promises)
                .then(() => true)
                .catch(error => {
                    showModal('Erro de Estoque', error.message);
                    return false;
                });
        }

        function reduceStock() {
            const promises = [];
            
            cart.forEach(item => {
                const productRef = db.collection('produtoshellen').doc(item.productId);
                
                promises.push(
                    productRef.get().then(doc => {
                        if (doc.exists) {
                            const product = doc.data();
                            const updatedColors = [...product.colors];
                            
                            item.colorQuantities.forEach(cq => {
                                if (updatedColors[cq.colorIndex]) {
                                    updatedColors[cq.colorIndex].stock -= cq.quantity;
                                    if (updatedColors[cq.colorIndex].stock < 0) {
                                        updatedColors[cq.colorIndex].stock = 0;
                                    }
                                }
                            });
                            
                            return productRef.update({ colors: updatedColors });
                        }
                    })
                );
            });
            
            return Promise.all(promises)
                .then(() => {
                    console.log('Estoque atualizado com sucesso');
                    loadProducts();
                })
                .catch(error => {
                    console.error('Erro ao atualizar estoque:', error);
                    throw error;
                });
        }

        function validateOrderForm() {
            const fields = [
                elements.customerName,
                elements.customerCep,
                elements.customerAddress,
                elements.deliveryType,
                elements.customerPhone,
                elements.paymentMethod
            ];
            
            for (let field of fields) {
                if (!field.value.trim()) {
                    showModal('Atenção', 'Preencha todos os campos obrigatórios.');
                    field.focus();
                    return false;
                }
            }
            
            return true;
        }

        function clearCheckoutForm() {
            elements.customerName.value = '';
            elements.customerCep.value = '';
            elements.customerAddress.value = '';
            elements.deliveryType.value = '';
            elements.customerPhone.value = '';
            elements.paymentMethod.value = '';
        }

        function prepareWhatsAppMessage(orderData) {
            let message = `*NOVO PEDIDO - HELLEN MODA FITNESS*\n\n`;
            message += `*Cliente:* ${orderData.customer.name}\n`;
            message += `*Telefone:* ${orderData.customer.phone}\n`;
            message += `*CEP:* ${orderData.customer.cep}\n`;
            message += `*Endereço:* ${orderData.customer.address}\n`;
            message += `*Tipo de Entrega:* ${orderData.customer.deliveryType}\n`;
            message += `*Forma de Pagamento:* ${orderData.customer.paymentMethod}\n\n`;
            message += `*ITENS DO PEDIDO:*\n`;
            
            let totalPecas = 0;
            
            orderData.items.forEach(item => {
                totalPecas += item.quantity;
                
                message += `- ${item.name} (`;
                const coresDetalhes = item.colorQuantities.map(cq => `${cq.colorName}: ${cq.quantity}`).join(', ');
                message += `${coresDetalhes})\n`;
                
                message += `  R$ ${item.price.toFixed(2)} x ${item.quantity} = R$ ${(item.price * item.quantity).toFixed(2)}\n`;
            });
            
            message += `\n*TOTAL: R$ ${orderData.total.toFixed(2)}*`;
            message += `\n*Total de peças: ${totalPecas}*`;
            
            return message;
        }

        // ===== FUNÇÕES DO ADMIN =====
        function checkAuthState() {
            auth.onAuthStateChanged(user => {
                if (user) {
                    currentUser = user;
                    elements.adminLogin.style.display = 'none';
                    elements.adminDashboard.style.display = 'block';
                    loadInventory();
                } else {
                    currentUser = null;
                    elements.adminLogin.style.display = 'block';
                    elements.adminDashboard.style.display = 'none';
                }
            });
        }

        function adminLogin() {
            const email = elements.adminEmail.value;
            const password = elements.adminPassword.value;
            
            if (!email || !password) {
                showModal('Atenção', 'Preencha e-mail e senha.');
                return;
            }
            
            auth.signInWithEmailAndPassword(email, password)
                .then(userCredential => {
                    currentUser = userCredential.user;
                    showModal('Sucesso', 'Login realizado com sucesso!');
                })
                .catch(error => {
                    console.error('Erro no login:', error);
                    showModal('Erro', 'E-mail ou senha incorretos.');
                });
        }

        function addColorInput() {
            const colorInput = document.createElement('div');
            colorInput.className = 'color-input';
            colorInput.innerHTML = `
                <input type="text" placeholder="Nome da cor" class="color-name">
                <input type="color" class="color-code" value="#c8499f">
                <input type="number" placeholder="Estoque" class="color-stock" min="0" value="0">
                <button type="button" class="remove-color">✕</button>
            `;
            
            elements.colorInputs.appendChild(colorInput);
            
            const removeButton = colorInput.querySelector('.remove-color');
            removeButton.addEventListener('click', function() {
                elements.colorInputs.removeChild(colorInput);
            });
        }

        function saveProduct() {
            if (!currentUser) {
                showModal('Atenção', 'Faça login para adicionar produtos.');
                return;
            }
            
            const name = elements.productName.value;
            const price = parseFloat(elements.productPrice.value);
            const category = elements.productCategory.value;
            const image = elements.productImage.value;
            
            if (!name || !price || !category || !image) {
                showModal('Atenção', 'Preencha todos os campos obrigatórios.');
                return;
            }
            
            const colorInputs = document.querySelectorAll('.color-input');
            const colors = [];
            
            colorInputs.forEach(input => {
                const colorName = input.querySelector('.color-name').value;
                const colorCode = input.querySelector('.color-code').value;
                const colorStock = parseInt(input.querySelector('.color-stock').value) || 0;
                
                if (colorName && colorStock >= 0) {
                    colors.push({
                        name: colorName,
                        code: colorCode,
                        stock: colorStock
                    });
                }
            });
            
            if (colors.length === 0) {
                showModal('Atenção', 'Adicione pelo menos uma cor.');
                return;
            }
            
            const productData = {
                name: name,
                price: price,
                category: category,
                image: image,
                colors: colors,
                createdAt: new Date(),
                createdBy: currentUser.email
            };
            
            if (editingProductId) {
                db.collection('produtoshellen').doc(editingProductId).update(productData)
                    .then(() => {
                        showModal('Sucesso', 'Produto atualizado com sucesso!');
                        resetProductForm();
                        loadProducts();
                        loadInventory();
                    })
                    .catch(error => {
                        console.error('Erro ao atualizar produto:', error);
                        showModal('Erro', 'Erro ao atualizar produto: ' + error.message);
                    });
            } else {
                db.collection('produtoshellen').add(productData)
                    .then(() => {
                        showModal('Sucesso', 'Produto adicionado com sucesso!');
                        resetProductForm();
                        loadProducts();
                        loadInventory();
                    })
                    .catch(error => {
                        console.error('Erro ao adicionar produto:', error);
                        showModal('Erro', 'Erro ao adicionar produto: ' + error.message);
                    });
            }
        }

        function resetProductForm() {
            elements.productName.value = '';
            elements.productPrice.value = '';
            elements.productCategory.value = '';
            elements.productImage.value = '';
            elements.colorInputs.innerHTML = '';
            editingProductId = null;
            elements.cancelEdit.style.display = 'none';
        }

        function loadInventory() {
            if (!currentUser) return;
            
            db.collection('produtoshellen').get()
                .then(snapshot => {
                    elements.inventoryBody.innerHTML = '';
                    
                    snapshot.forEach(doc => {
                        const product = {
                            id: doc.id,
                            ...doc.data()
                        };
                        
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${product.name}</td>
                            <td>${product.category}</td>
                            <td>R$ ${product.price.toFixed(2)}</td>
                            <td>
                                ${product.colors.map(color => 
                                    `<div>${color.name}: ${color.stock}</div>`
                                ).join('')}
                            </td>
                            <td>
                                <button class="edit-button" data-id="${product.id}">Editar</button>
                                <button class="delete-button" data-id="${product.id}">Excluir</button>
                            </td>
                        `;
                        
                        elements.inventoryBody.appendChild(row);
                    });
                    
                    const editButtons = document.querySelectorAll('.edit-button');
                    const deleteButtons = document.querySelectorAll('.delete-button');
                    
                    editButtons.forEach(button => {
                        button.addEventListener('click', function() {
                            const productId = this.getAttribute('data-id');
                            editProduct(productId);
                        });
                    });
                    
                    deleteButtons.forEach(button => {
                        button.addEventListener('click', function() {
                            const productId = this.getAttribute('data-id');
                            deleteProduct(productId);
                        });
                    });
                })
                .catch(error => {
                    console.error('Erro ao carregar inventário:', error);
                });
        }

        function editProduct(productId) {
            db.collection('produtoshellen').doc(productId).get()
                .then(doc => {
                    if (doc.exists) {
                        const product = doc.data();
                        
                        elements.productName.value = product.name;
                        elements.productPrice.value = product.price;
                        elements.productCategory.value = product.category;
                        elements.productImage.value = product.image;
                        
                        elements.colorInputs.innerHTML = '';
                        
                        if (product.colors && product.colors.length > 0) {
                            product.colors.forEach(color => {
                                const colorInput = document.createElement('div');
                                colorInput.className = 'color-input';
                                colorInput.innerHTML = `
                                    <input type="text" placeholder="Nome da cor" class="color-name" value="${color.name}">
                                    <input type="color" class="color-code" value="${color.code}">
                                    <input type="number" placeholder="Estoque" class="color-stock" min="0" value="${color.stock}">
                                    <button type="button" class="remove-color">✕</button>
                                `;
                                
                                elements.colorInputs.appendChild(colorInput);
                                
                                const removeButton = colorInput.querySelector('.remove-color');
                                removeButton.addEventListener('click', function() {
                                    elements.colorInputs.removeChild(colorInput);
                                });
                            });
                        }
                        
                        editingProductId = productId;
                        elements.cancelEdit.style.display = 'block';
                    }
                })
                .catch(error => {
                    console.error('Erro ao carregar produto para edição:', error);
                });
        }

        function deleteProduct(productId) {
            if (confirm('Tem certeza que deseja excluir este produto?')) {
                db.collection('produtoshellen').doc(productId).delete()
                    .then(() => {
                        showModal('Sucesso', 'Produto excluído com sucesso!');
                        loadProducts();
                        loadInventory();
                    })
                    .catch(error => {
                        console.error('Erro ao excluir produto:', error);
                        showModal('Erro', 'Erro ao excluir produto.');
                    });
            }
        }

        // ===== FUNÇÃO DE MODAL =====
        function showModal(title, message) {
            elements.modalTitle.textContent = title;
            elements.modalMessage.textContent = message;
            elements.confirmationModal.style.display = 'flex';
        }
    </script>
</body>
</html>
